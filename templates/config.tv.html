{% extends "_content.html" %}

{% block title %}
Trova - TV Setup
{% endblock %}

{% block page_title %}
TV Setup
{% endblock %}

{% block page_buttons %}
<button type="reset" id="button_cancel" class="btn btn-danger" form="config.tv">Cancel</button>
<button id="button_save" class="btn btn-success" form="config.tv">Save</button>
{% endblock %}

{% block page_content %}
{% load widget_tweaks %}

<form method="post" id="config.tv" ic-post-to="{% url 'apps:configure_tv' %}" ic-on-success="onSuccess();" ic-on-error="onError();" ic-on-beforeSend="xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');" >
    {% csrf_token %}
    
    {% for hidden in form.hidden_fields %}
    {{ hidden }}
    {% endfor %}
    
    {% if form.non_field_errors %}
    <div class="alert alert-danger" role="alert">
        {% for error in form.non_field_errors %}
        {{ error }}
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="row">
        <div class="col-md-6">
            
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">General</h3>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <label>{{ form.tv_enabled.label_tag }}</label>
                        {{ form.tv_enabled|add_class:'form-control' }}
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Suggestions</h3>
                </div>
                <div class="panel-body">
                    <fieldset id="suggestions-fieldset">
                        <div class="form-group">
                            <label>{{ form.suggestions_trending_enabled.label_tag }}</label>
                            {{ form.suggestions_trending_enabled|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.suggestions_popular_enabled.label_tag }}</label>
                            {{ form.suggestions_popular_enabled|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.suggestions_anticipated_enabled.label_tag }}</label>
                            {{ form.suggestions_anticipated_enabled|add_class:'form-control' }}
                        </div>
                    </fieldset>
                </div>
            </div>
            
            <div class="panel panel-default" id="api-credentials">
                <div class="panel-heading">
                    <h3 class="panel-title">API Credentials</h3>
                </div>
                <fieldset id="api-credentials-fieldset">
                    <div class="panel-body">
                        <div class="form-group">
                            <label>{{ form.api_key_trakt.label_tag }}</label>
                            {{ form.api_key_trakt|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.api_key_tvdb.label_tag }}</label>
                            {{ form.api_key_tvdb|add_class:'form-control' }}
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="panel panel-default" id="sonarr">
                <div class="panel-heading">
                    <h3 class="panel-title">Sonarr</h3>
                </div>
                <fieldset id="sonarr-fieldset">
                    <div class="panel-body">
                        <div class="form-group">
                            <label>{{ form.sonarr_host.label_tag }}</label>
                            {{ form.sonarr_host|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.sonarr_port.label_tag }}</label>
                            {{ form.sonarr_port|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.sonarr_api_key.label_tag }}</label>
                            {{ form.sonarr_api_key|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.sonarr_sub_directory.label_tag }}</label>
                            {{ form.sonarr_sub_directory|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.sonarr_ssl.label_tag }}</label>
                            {{ form.sonarr_ssl|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.sonarr_quality_profile.label_tag }}</label>
                            {{ form.sonarr_quality_profile|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.sonarr_tv_dir.label_tag }}</label>
                            {{ form.sonarr_tv_dir|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <label>{{ form.sonarr_season_folders.label_tag }}</label>
                            {{ form.sonarr_season_folders|add_class:'form-control' }}
                        </div>
                        <div class="form-group">
                            <button type="button" id="button-test-sonarr" class="btn btn-success">Test Sonarr</button>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        
    </div>
    
</form>

<script>
    $(document).ready(function() {
        fieldset_toggler('id_tv_enabled', ['suggestions-fieldset','api-credentials-fieldset','sonarr-fieldset']);
    }); 

    function onSuccess(){
        console.log("Saved");
    }

    function onError(){
        console.log("Error");
    }
    
    $('#button-test-sonarr').click(function(){
        requestData = {'url':$('#id_sonarr_host').val(), 'port':$('#id_sonarr_port').val(), 'api_key':$('#id_sonarr_api_key').val()}
        console.log(requestData);
        var result = sonarr_get_status(requestData);

    });
    
</script>
<div id="blackhole"></div>
{% endblock %}